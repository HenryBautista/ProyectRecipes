create database recipes
go
use recipes
go

create table t_nutrient
(
nu_nutrient int identity(1,1) not null primary key,
nu_name varchar(50)
)

create table t_ingredient
(
in_ingredient int identity(1,1) not null primary key,
in_ingredient_id varchar(20),
in_name varchar(50),
in_unit int,					--HACE REFERENCIA A LA TABLA CONCEPTS
in_cost float,
in_factor float,
in_category int,				--HACE REFERENCIA A LA TABLA CONCEPTS
in_origin int				    --HACE REFERENCIA A LA TABLA CONCEPTS
)
create table t_concept
(
co_concept int,
co_correlative int,
co_name varchar(50),
co_abbrevation varchar(20)
)

INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(1,0,'TURNOS','TURNOS')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(1,1,'DESAYUNO','DES')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(1,2,'ALMUERZO','ALM')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(1,3,'CENA','CENA')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(2,0,'UNIDADES','UNIDADES')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(2,1,'KILO','KG')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(2,2,'LITRO','LT')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(3,0,'CATEGORIA','CATEGORIA')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(3,1,'CATEGORIA 1','CAT1')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(3,2,'CATEGORIA 2','CAT2')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(4,0,'ORIGEN','ORIGEN')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(4,1,'ANIMAL','ANI')
INSERT INTO t_concept(co_concept, co_correlative,co_name,co_abbrevation)
VALUES(4,2,'VEGETAL','VEG')

insert into t_nutrient(nu_name)
Values('Ácidos Grasos'),
Values('AZUCAR'),
Values('FIBRA'),
Values('PROTEINAS')

insert into t_ingredient(in_ingredient_id,in_name,in_unit,in_cost,in_category,in_origin)
Values('ING-01','pollo','1','14','1','1'),
Values('ING-02','carne res','1','22','1','1'),
Values('ING-02','huevo','1','22','1','1'),
Values('ING-04','leche','2','5','2','2'),
Values('ING-03','zanahoria','1','4','2','2'),
Values('ING-06','leche de coco','2','1','2','2'),
Values('ING-07','harina','1','3.5','1','2')


--procedimientos

CREATE procedure [dbo].[sp_ingredient]
(
@i_action varchar(2) =null,
------------ valores de la tabla
@i_ingredient int = null,
@i_ingredient_id varchar(20) = null,
@i_name varchar(50)= null,
@i_unit int= null,				--HACE REFERENCIA A LA TABLA CONCEPTS
@i_cost float= null,
@i_factor float= null,
@i_category int= null,			--HACE REFERENCIA A LA TABLA CONCEPTS
@i_origin int =null
-----------
)
as
begin
    if(@i_action='S1')
    begin
        select* from t_ingredient
    end
    
    if(@i_action='S2')
    begin
        select* from t_ingredient where in_ingredient_id=@i_ingredient_id
    end

	if(@i_action='S3')
    begin
	 declare @a int=null,
 @b int=null,
 @c int=null,
 @d int=null
 declare @algo table(
	id int,
	NOMBRE varchar(50),
	ABREVIACION varchar(20),
	CATEGORIA varchar(50),
	ORIGEN varchar(50)
 )
declare curso cursor scroll
for select in_unit,in_category,in_origin,in_ingredient
	from t_ingredient
open curso
fetch curso into @a,@b,@c,@d
insert into @algo select * from get_details_ingredients(@a,@b,@c,@d)
FETCH NEXT FROM curso into @a,@b,@c,@d
while(@@FETCH_STATUS=0)
begin

insert into @algo select * from get_details_ingredients(@a,@b,@c,@d)
FETCH NEXT FROM curso into @a,@b,@c,@d
end
select x.in_ingredient, in_name as product_name, x.in_unit as unit, y.NOMBRE AS NAME,y.ABREVIACION AS abrebb,  x.in_cost as cost, x.in_factor as factor, x.in_category as category, y.CATEGORIA AS category, x.in_origin as origin, y.ORIGEN AS ORIGIN
from @algo y,t_ingredient x
where y.id=x.in_ingredient


close curso
deallocate curso




	end
	if(@i_action='F2')
    begin
        select x.nu_nutrient,x.nu_name
		from t_nutrient x,t_ingredient_nutrient y
		where x.nu_nutrient=y.in_nutrient and @i_ingredient=y.in_ingredient
    end
    if(@i_action='I1')
    begin
        	insert into t_ingredient
			(
		
		
			in_ingredient_id,
			in_name,
			in_unit,					
			in_cost,
			in_factor,
			in_category,				
			in_origin		
			)
		values
			(
		
			
			@i_ingredient_id,
			@i_name,
			@i_unit,				
			@i_cost,
			@i_factor,
			@i_category,			
			@i_origin
			)
    end

        if(@i_action='U1')
   begin
		update t_ingredient set 
			
			in_ingredient_id=@i_ingredient_id,
			in_name=@i_name,
			in_unit=@i_unit,					
			in_cost=@i_cost,
			in_factor=@i_factor,
			in_category=@i_category,				
			in_origin=@i_origin
		where in_ingredient=@i_ingredient
	end

        if(@i_action='D1')
    begin
        delete t_ingredient where in_ingredient=@i_ingredient
    end

end
GO


CREATE procedure [dbo].[sp_nutrient]
(
@i_action varchar(2) =null,
------------ valores de la tabla
@i_nutrient int =null,
@i_name varchar(50)=null,
@i_quantity float =null
-----------
)
as
begin
    if(@i_action='S1')
    begin
        select* from t_nutrient
    end
    
    if(@i_action='S2')
    begin
        select* from t_nutrient where nu_name=@i_name
    end

    if(@i_action='I1')
    begin
        	insert into t_nutrient
			(
		
				nu_name,
				nu_quantity
			)
		values
			(
		
				@i_name,
				@i_quantity
			)
    end

        if(@i_action='U1')
   begin
		update t_nutrient set 
			
				nu_name=@i_name,
				nu_quantity=@i_quantity
		where nu_nutrient=@i_nutrient
	end

        if(@i_action='D1')
    begin
        delete t_nutrient where nu_nutrient=@i_nutrient
    end

end
GO


create procedure [dbo].[sp_concept]
(
@i_action varchar(2),
@i_concept smallint=null,
@i_correlative smallint =null,
@i_name varchar(500) =null,
@i_abbreviation varchar(50) =null
)
as
begin

	if @i_action ='S1'
	begin
		select
		co_concept,
		co_correlative,
		co_name,
		co_abbrevation
		from t_concept
		where co_concept =@i_concept and co_correlative >0
	end
end

GO


